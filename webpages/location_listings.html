<!DOCTYPE html>
<html>
    <head>
        <title>Hotel Results</title>
    </head>
    <body>
        <script>
            async function searchHotels() {
                let url = "http://localhost:8080/location_listings/";
                let currentUrl = window.location.href;
                let destinationIndex = currentUrl.indexOf("?");
                //let destinationId = currentUrl.substring(destinationIndex + 15);
                //document.write(destinationId);
                let params = (new URL(document.location)).searchParams;

                let userId = params.get("userId")
                let destinationId = params.get("destinationId");

                let urlWithParam = url + destinationId;
                let response = await fetch(urlWithParam);
                let text = await response.json();
   
                if (text) {
                    for (element of text) {
                        console.log(element);
                        let tmpUrl = "hotel_listing.html?userId=" + userId + 
                            "&hotelId=" + element.id;

                        document.getElementById("resultsTable").innerHTML =
                        document.getElementById("resultsTable").innerHTML.concat(
                            "<tr><td><a href=\"" + tmpUrl + "\">" + element.name + "</a></td>" +
                            "<td>" + element.starRating + "</td>" +
                            "<td>" + element.currentPrice + "</td></tr>"
                        );
                    }
                } else {
                    alert("Error: search failed.");
                }
            }
            searchHotels();
        </script>
        <table id="resultsTable">
            <tr>
                <th>Name</th>
                <th>Star Rating</th>
                <th>Current Price</th>
            </tr>
        </table>
    </body>
</html>
    